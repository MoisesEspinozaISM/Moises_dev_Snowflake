CREATE OR REPLACE TEMPORARY TABLE dev_silver_m.comercial.RESUMEN_silver_ventas_sap
AS
select
;
WITH RESUMEN_SAP AS (
SELECT 
PERIODO,
id_centro_origen,
ID_CANAL,
id_sku_origen,
SUM(
    CASE 
        WHEN CLASE_FACTURA = 'ZD01' THEN -LITROS_FACTURA_CALCULADO
        ELSE LITROS_FACTURA_CALCULADO
    END
) AS LITROS, 
SUM(
    CASE WHEN CLASE_FACTURA = 'ZD01' THEN -pqt_matcat
    ELSE pqt_matcat
    END
) AS PQT,
SUM(
    CASE WHEN CLASE_FACTURA = 'ZD01' THEN -MONTO_NETO_MONEDA_LOCAL
    ELSE MONTO_NETO_MONEDA_LOCAL
    END
) AS MONTO,
SUM(
    CASE WHEN CLASE_FACTURA = 'ZD01' THEN -MONTO_NETO_DOCUMENTO
    ELSE MONTO_NETO_DOCUMENTO
    END
) AS MONTO_D
from dev_silver_m.comercial.silver_ventas_sap
WHERE ID_PAIS = 'DO'
AND ID_SOCIEDAD_ORIGEN = '1000'
AND PERIODO IN ('202508', '202509', '202510')
and id_tipo_material = 'ZFER'
-- AND CLASE_FACTURA IN ('ZC01', 'ZD01', 'ZF01','ZP01')
AND FLAG_FACTURA_ANULADA <> 'X'
AND MONTO_NETO_MONEDA_LOCAL <> 0
and id_factura_referencia not in
(select distinct id_factura_referencia from dev_silver_m.comercial.silver_ventas_sap where estado_liquidacion ='RT')
AND ESTADO_LIQUIDACION <> 'NA'
GROUP BY PERIODO,
id_centro_origen,
ID_CANAL,
id_sku_origen
order by  PERIODO, id_canal desc
)
SELECT
PERIODO, 
SUM(LITROS) AS LITROS,
FROM RESUMEN_SAP
GROUP BY PERIODO
ORDER BY PERIODO ASC 
;

CREATE OR REPLACE TEMPORARY TABLE dev_silver_m.comercial.VENTAS_DO_NEGOCIO_RESUMEN
AS
SELECT 
    PERIODO,
    CENTRO AS id_centro_origen,
    CANAL AS ID_CANAL,
    "COD.MAT" AS id_sku_origen,
    SUM("LITROS VENTA") AS LITROS,
    SUM("V.BRUTA") AS MONTO
    -- SELECT *
FROM STAGING_CORP.SHAREPOINT.VENTAS_DO_NEGOCIO 
GROUP BY 
    PERIODO,
    CENTRO,
    CANAL,
    id_sku_origen

SELECT
    COALESCE(A.PERIODO,B.PERIODO) AS PERIODO,
    COALESCE(A.ID_CENTRO_ORIGEN, B.ID_CENTRO_ORIGEN) AS ID_CENTRO_ORIGEN,
    COALESCE(A.ID_CANAL,B.ID_CANAL) AS ID_CANAL,
    COALESCE(A.ID_SKU_ORIGEN,B.ID_SKU_ORIGEN) AS ID_SKU_ORIGEN,
    CASE 
        WHEN A.ID_SKU_ORIGEN IS NOT NULL AND B.ID_SKU_ORIGEN IS NOT NULL THEN '01. COINCIDENCIA'
        WHEN A.ID_SKU_ORIGEN IS NOT NULL THEN '02. SOLO SNOWFLAKE'
        ELSE '03. SOLO DO'
    END AS FLAG_COINCIDENCIA,
    A.LITROS AS LITROS_SNOWFLAKE,
    A.PQT AS PAQUETES_SNOWFLAKE,
    A.MONTO AS MONTO_SNOWFLAKE,
    A.MONTO_D AS MONTO_D_SNOWFLAKE,
    B.LITROS AS LITROS_DO,
    B.MONTO AS MONTO_DO
FROM dev_silver_m.comercial.RESUMEN_silver_ventas_sap A
FULL JOIN dev_silver_m.comercial.VENTAS_DO_NEGOCIO_RESUMEN B
; 

SELECT FROM STAGING_CORP.SHAREPOINT.VENTAS_DO_NEGOCIO 