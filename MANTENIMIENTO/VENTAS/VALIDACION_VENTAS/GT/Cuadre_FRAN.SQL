
SELECT * FROM dev_silver_m.comercial.silver_ventas_sap 
where ID_PAIS = 'GT'
LIMIT 100; 

SELECT 
-- SUM(cantidad_unidad_base) as botellas_facturadas,
SUM(
CASE 
    WHEN TIPO_DOCUMENTO_COMERCIAL IN ('O','N') THEN -LITROS_CALCULADOS_SNOW
    ELSE LITROS_CALCULADOS_SNOW
END
) AS litros_snowflake,  
SUM(
    CASE 
        WHEN TIPO_DOCUMENTO_COMERCIAL IN ('O','N') THEN -pqt_matcat
        ELSE pqt_matcat
    END
) AS pqt_matcat,
SUM(
    CASE 
        WHEN TIPO_DOCUMENTO_COMERCIAL IN ('O','N') THEN -monto_neto_documento
        ELSE monto_neto_documento
    END
) AS monto_snowflake,
-- ID_SKU_ORIGEN,
-- NOM_SKU,
periodo 
FROM dev_silver_m.comercial.silver_ventas_sap 
where ID_PAIS = 'GT'
AND ID_SOCIEDAD_ORIGEN = 'C100'
AND periodo = '202510' 
AND CLASE_FACTURA IN ('S1', 'ZD40', 'ZP40', 'ZP99')
-- AND ID_CANAL != '91'
AND ID_CLIENTE_ORIGEN NOT IN('C101','C102','C103','C104','C105','C106','C107','0000000101','0000000102','0000000103','0000000104','0000000105','0000000106','0000000107','0300000000',
'C300000000','0000003000','000000C101','000000C102','000000C103','000000C104','000000C105','000000C106','000000C107','1600000000',
'1600000016','1600000020','1600000011','1600000025','1600000030','1600000031','1600000032','1600000033','1600000034','1600000041',
'1300000172','1300000190','1300000195','1300000198','1300000199','1300000206','1300000218','1300000236','1300000238','1300000239',
'1300000240','1300000331','1300000340','1300000341','1300000342','1300000343','1300000018','1300000024','1300000028','1300000052',
'1300000078','1300000094','1300000104','1300000162','1300000165','1300000196','1300000259','1300000266','1300000292','1300000300',
'1300000308','1300000316','1300000320','1300000335','0500000038','0500000133','0500000137','0500000138','0500000140','0500000142',
'0500000170','0500000260','0500000402','0500000507','1300000061','1300000081','1200000100','0003002584','0002000001','1900000000',
'0600000000','0800000005','0700000000','0200000000','1300000270','0700000010','0700000006','0700000005','0700000020','0800000061',
'0800000014','0800000033','0800000002','0800000001','0800000000','1300000350','1300000299','1300000071','1300000402','1300000381',
'1300000314','1300000154','1300000101','0003002585','0500000624','0500000662','0500000649','0500000646','0500000089','1500133250')
AND ID_TIPO_MATERIAL = 'ZFER'
GROUP BY periodo 
ORDER BY periodo asc 
;

////////////////////////////// VISTA PRINCIPAL /////////////////////////////////////////////////////////////////////////// 

SELECT 
periodo ,
SUM(
CASE 
    WHEN TIPO_DOCUMENTO_COMERCIAL IN ('O','N') THEN -LITROS_CALCULADOS_SNOW
    ELSE LITROS_CALCULADOS_SNOW
END
) AS litros_snowflake,  
SUM(
    CASE 
        WHEN TIPO_DOCUMENTO_COMERCIAL IN ('O','N') THEN -pqt_matcat
        ELSE pqt_matcat
    END
) AS pqt_matcat,
SUM(
    CASE 
        WHEN TIPO_DOCUMENTO_COMERCIAL IN ('O','N') THEN -monto_neto_documento
        ELSE monto_neto_documento
    END
) AS monto_snowflake
FROM dev_silver_m.comercial.silver_ventas_sap 
INNER JOIN STAGING_RD_HT_GT.SAP.VBAK VBAK ON ID_PEDIDO = VBAK.VBELN
where ID_PAIS = 'GT'
AND ID_SOCIEDAD_ORIGEN = 'C100'
AND periodo BETWEEN '202501' AND '202510' 
-- AND PERIODO = '202502'
AND CLASE_FACTURA IN ('S1', 'ZD40', 'ZP40', 'ZP99')
AND ID_CANAL != '91'
AND ID_CLIENTE_ORIGEN NOT IN ('C101','C102','C103','C104','C105','C106','C107','0000000101','0000000102','0000000103','0000000104','0000000105','0000000106','0000000107','0300000000',
'C300000000','0000003000','000000C101','000000C102','000000C103','000000C104','000000C105','000000C106','000000C107','1600000000',
'1600000016','1600000020','1600000011','1600000025','1600000030','1600000031','1600000032','1600000033','1600000034','1600000041',
'1300000172','1300000190','1300000195','1300000198','1300000199','1300000206','1300000218','1300000236','1300000238','1300000239',
'1300000240','1300000331','1300000340','1300000341','1300000342','1300000343','1300000018','1300000024','1300000028','1300000052',
'1300000078','1300000094','1300000104','1300000162','1300000165','1300000196','1300000259','1300000266','1300000292','1300000300',
'1300000308','1300000316','1300000320','1300000335','0500000038','0500000133','0500000137','0500000138','0500000140','0500000142',
'0500000170','0500000260','0500000402','0500000507','1300000061','1300000081','1200000100','0003002584','0002000001','1900000000',
'0600000000','0800000005','0700000000','0200000000','1300000270','0700000010','0700000006','0700000005','0700000020','0800000061',
'0800000014','0800000033','0800000002','0800000001','0800000000','1300000350','1300000299','1300000071','1300000402','1300000381',
'1300000314','1300000154','1300000101','0003002585','0500000624','0500000662','0500000649','0500000646','0500000089','1500133250'
-- agregando nuevos filtros 
,'0500000525'
)
AND ID_SKU_ORIGEN NOT IN (
    '000000000000053439',
    '000000000000053440',
    '000000000000053573',
    '000000000000053574',
    '000000000000060002',
    '000000000000060006',
    '000000000000060007',
    '000000000000060008',
    '000000000000060011', 
    '000000000000053837',
    '000000000000060020'
)
-- AND ID_TIPO_MATERIAL = 'ZFER'
-- AND monto_neto_documento <> 0 
AND (
        TIPO_POSICION = 'ZKOM'          
        OR MONTO_NETO_DOCUMENTO <> 0   
      )
GROUP BY periodo 
ORDER BY periodo asc 
;

/////////////////////////////////////////   VISTA PRINCIPAL VOLUM   - FIMAL FILANITO //////////////////////////////////////////////////////////////////////////
SELECT 
periodo ,
SUM(
CASE 
    WHEN TIPO_DOCUMENTO_COMERCIAL IN ('O','N') THEN -LITROS_CALCULADOS_SNOW
    ELSE LITROS_CALCULADOS_SNOW
END
) AS LITROS,  
SUM(
    CASE 
        WHEN TIPO_DOCUMENTO_COMERCIAL IN ('O','N') THEN -pqt_matcat
        ELSE pqt_matcat
    END
) AS pqt_matcat,
SUM(
    CASE 
        WHEN TIPO_DOCUMENTO_COMERCIAL IN ('O','N') THEN -monto_neto_documento
        ELSE monto_neto_documento
    END
) AS monto_snowflake
FROM dev_silver_m.comercial.silver_ventas_sap 
INNER JOIN STAGING_RD_HT_GT.SAP.VBAK VBAK ON ID_PEDIDO = VBAK.VBELN
where ID_PAIS = 'GT'
AND ID_SOCIEDAD_ORIGEN = 'C100'
AND periodo BETWEEN '202501' AND '202510' 
-- AND PERIODO = '202502'
AND CLASE_FACTURA IN ('S1', 'ZD40', 'ZP40', 'ZP99')
AND ID_CANAL != '91'
AND ID_CLIENTE_ORIGEN NOT IN ('C101','C102','C103','C104','C105','C106','C107','0000000101','0000000102','0000000103','0000000104','0000000105','0000000106','0000000107','0300000000',
'C300000000','0000003000','000000C101','000000C102','000000C103','000000C104','000000C105','000000C106','000000C107','1600000000',
'1600000016','1600000020','1600000011','1600000025','1600000030','1600000031','1600000032','1600000033','1600000034','1600000041',
'1300000172','1300000190','1300000195','1300000198','1300000199','1300000206','1300000218','1300000236','1300000238','1300000239',
'1300000240','1300000331','1300000340','1300000341','1300000342','1300000343','1300000018','1300000024','1300000028','1300000052',
'1300000078','1300000094','1300000104','1300000162','1300000165','1300000196','1300000259','1300000266','1300000292','1300000300',
'1300000308','1300000316','1300000320','1300000335','0500000038','0500000133','0500000137','0500000138','0500000140','0500000142',
'0500000170','0500000260','0500000402','0500000507','1300000061','1300000081','1200000100','0003002584','0002000001','1900000000',
'0600000000','0800000005','0700000000','0200000000','1300000270','0700000010','0700000006','0700000005','0700000020','0800000061',
'0800000014','0800000033','0800000002','0800000001','0800000000','1300000350','1300000299','1300000071','1300000402','1300000381',
'1300000314','1300000154','1300000101','0003002585','0500000624','0500000662','0500000649','0500000646','0500000089','1500133250'
-- agregando nuevos filtros 
,'0500000525'
)
AND ID_SKU_ORIGEN NOT IN (
    '000000000000053439',
    '000000000000053440',
    '000000000000053573',
    '000000000000053574',
    '000000000000060002',
    '000000000000060006',
    '000000000000060007',
    '000000000000060008',
    '000000000000060011', 
    '000000000000053837',
    '000000000000060020'
)
-- AND ID_TIPO_MATERIAL = 'ZFER'
AND monto_neto_documento <> 0 
-- AND (
--         TIPO_POSICION = 'ZKOM'          
--         OR MONTO_NETO_DOCUMENTO <> 0   
--       )
GROUP BY periodo 
ORDER BY periodo asc 
;

////////////////////////////// VISTA PRINCIPAL A NIVEL DE             FACTURA  /////////////////////////////////////////////////////////////////////////// 

SELECT 
ID_FACTURA ,
-- SUM(cantidad_unidad_base) as botellas_facturadas,
SUM(
CASE 
    WHEN TIPO_DOCUMENTO_COMERCIAL IN ('O','N') THEN -LITROS_CALCULADOS_SNOW
    ELSE LITROS_CALCULADOS_SNOW
END
) AS litros_snowflake,  
SUM(
    CASE 
        WHEN TIPO_DOCUMENTO_COMERCIAL IN ('O','N') THEN -pqt_matcat
        ELSE pqt_matcat
    END
) AS pqt_matcat,
SUM(
    CASE 
        WHEN TIPO_DOCUMENTO_COMERCIAL IN ('O','N') THEN -monto_neto_documento
        ELSE monto_neto_documento
    END
) AS monto_snowflake
FROM dev_silver_m.comercial.silver_ventas_sap 
INNER JOIN STAGING_RD_HT_GT.SAP.VBAK VBAK ON ID_PEDIDO = VBAK.VBELN
where ID_PAIS = 'GT'
AND ID_SOCIEDAD_ORIGEN = 'C100'
-- AND periodo BETWEEN '202501' AND '202510' 
AND PERIODO = '202502'
AND CLASE_FACTURA IN ('S1', 'ZD40', 'ZP40', 'ZP99')
AND ID_CANAL != '91'
AND ID_CLIENTE_ORIGEN NOT IN ('C101','C102','C103','C104','C105','C106','C107','0000000101','0000000102','0000000103','0000000104','0000000105','0000000106','0000000107','0300000000',
'C300000000','0000003000','000000C101','000000C102','000000C103','000000C104','000000C105','000000C106','000000C107','1600000000',
'1600000016','1600000020','1600000011','1600000025','1600000030','1600000031','1600000032','1600000033','1600000034','1600000041',
'1300000172','1300000190','1300000195','1300000198','1300000199','1300000206','1300000218','1300000236','1300000238','1300000239',
'1300000240','1300000331','1300000340','1300000341','1300000342','1300000343','1300000018','1300000024','1300000028','1300000052',
'1300000078','1300000094','1300000104','1300000162','1300000165','1300000196','1300000259','1300000266','1300000292','1300000300',
'1300000308','1300000316','1300000320','1300000335','0500000038','0500000133','0500000137','0500000138','0500000140','0500000142',
'0500000170','0500000260','0500000402','0500000507','1300000061','1300000081','1200000100','0003002584','0002000001','1900000000',
'0600000000','0800000005','0700000000','0200000000','1300000270','0700000010','0700000006','0700000005','0700000020','0800000061',
'0800000014','0800000033','0800000002','0800000001','0800000000','1300000350','1300000299','1300000071','1300000402','1300000381',
'1300000314','1300000154','1300000101','0003002585','0500000624','0500000662','0500000649','0500000646','0500000089','1500133250'
-- agregando nuevos filtros 
,'0500000525'
)
AND ID_SKU_ORIGEN NOT IN (
    '000000000000053439',
    '000000000000053440',
    '000000000000053573',
    '000000000000053574',
    '000000000000060002',
    '000000000000060006',
    '000000000000060007',
    '000000000000060008',
    '000000000000060011', 
    '000000000000053837',
    '000000000000060020'
)
-- AND ID_TIPO_MATERIAL = 'ZFER'
AND monto_neto_documento <> 0 
GROUP BY ID_FACTURA 
ORDER BY ID_FACTURA asc
;


////////////////////////////// DETALLE DE CASOS ESPECIDFICOS    -        VALIDANDO CASOS /////////////////////////////////////////////////////////////////////////// 

SELECT 
ID_FACTURA ,
ID_SKU_ORIGEN, 
NOM_SKU,
TIPO_POSICION, 
NOM_TIPO_POSICION,
CLASE_FACTURA, 
unidad_facturada,
cantidad_facturada, 
litros_factura_calculado,
unidad_volumen,
unidad_base,
cantidad_unidad_base,
SUM(
    CASE 
        WHEN TIPO_DOCUMENTO_COMERCIAL IN ('O','N') THEN -pqt_matcat
        ELSE pqt_matcat
    END
) AS pqt_matcat, 
SUM(
CASE 
    WHEN TIPO_DOCUMENTO_COMERCIAL IN ('O','N') THEN -LITROS_CALCULADOS_SNOW
    ELSE LITROS_CALCULADOS_SNOW
END
) AS litros_snowflake, 
FROM dev_silver_m.comercial.silver_ventas_sap 
INNER JOIN STAGING_RD_HT_GT.SAP.VBAK VBAK ON ID_PEDIDO = VBAK.VBELN
where ID_PAIS = 'GT'
AND ID_SOCIEDAD_ORIGEN = 'C100'
-- AND periodo BETWEEN '202501' AND '202510' 
AND PERIODO = '202502'
AND CLASE_FACTURA IN ('S1', 'ZD40', 'ZP40', 'ZP99')
AND ID_CANAL != '91'
AND ID_CLIENTE_ORIGEN NOT IN ('C101','C102','C103','C104','C105','C106','C107','0000000101','0000000102','0000000103','0000000104','0000000105','0000000106','0000000107','0300000000',
'C300000000','0000003000','000000C101','000000C102','000000C103','000000C104','000000C105','000000C106','000000C107','1600000000',
'1600000016','1600000020','1600000011','1600000025','1600000030','1600000031','1600000032','1600000033','1600000034','1600000041',
'1300000172','1300000190','1300000195','1300000198','1300000199','1300000206','1300000218','1300000236','1300000238','1300000239',
'1300000240','1300000331','1300000340','1300000341','1300000342','1300000343','1300000018','1300000024','1300000028','1300000052',
'1300000078','1300000094','1300000104','1300000162','1300000165','1300000196','1300000259','1300000266','1300000292','1300000300',
'1300000308','1300000316','1300000320','1300000335','0500000038','0500000133','0500000137','0500000138','0500000140','0500000142',
'0500000170','0500000260','0500000402','0500000507','1300000061','1300000081','1200000100','0003002584','0002000001','1900000000',
'0600000000','0800000005','0700000000','0200000000','1300000270','0700000010','0700000006','0700000005','0700000020','0800000061',
'0800000014','0800000033','0800000002','0800000001','0800000000','1300000350','1300000299','1300000071','1300000402','1300000381',
'1300000314','1300000154','1300000101','0003002585','0500000624','0500000662','0500000649','0500000646','0500000089','1500133250'
-- agregando nuevos filtros 
,'0500000525'
)
AND ID_SKU_ORIGEN NOT IN (
    '000000000000053439',
    '000000000000053440',
    '000000000000053573',
    '000000000000053574',
    '000000000000060002',
    '000000000000060006',
    '000000000000060007',
    '000000000000060008',
    '000000000000060011', 
    '000000000000053837',
    '000000000000060020'
)
-- AND ID_TIPO_MATERIAL = 'ZFER'
-- AND monto_neto_documento <> 0 
AND (
        TIPO_POSICION = 'ZKOM'          
        OR MONTO_NETO_DOCUMENTO <> 0   
      )
AND ID_FACTURA = '0951075363'
GROUP BY 1,2,3,4,5,6,7,8,9,10,11,12
ORDER BY ID_FACTURA asc
;

/////// encontrando mas clientes 
SELECT 
VBELN, 
MATNR, 
PSTYV, 
FKIMG, 
VRKME 
FROM STAGING_RD_HT_GT.SAP.VBRP
WHERE VBELN = '0951075363'
;

SELECT * FROM TEST_SILVER.COMERCIAL.SILVER_MAESTRO_PRODUCTO
WHERE ID_SKU_ORIGEN LIKE '%60004%'
;
