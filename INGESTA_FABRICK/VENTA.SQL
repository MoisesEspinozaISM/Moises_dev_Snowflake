WITH v AS (
  SELECT
    TRY_TO_DATE(TO_VARCHAR(idFeContabilizacion), 'YYYYMMDD') AS fecha
  FROM STAGING_PE_CH.SQL_FABRIC.VENTA
  WHERE idFeContabilizacion BETWEEN 20250101 AND 20251231
)
SELECT
  TO_CHAR(DATE_TRUNC('MONTH', fecha), 'YYYYMM') AS periodo,
  COUNT(*) AS registros
FROM v
WHERE fecha IS NOT NULL
GROUP BY 1
ORDER BY 1;