WITH v AS (
  SELECT
    TRY_TO_DATE(TO_VARCHAR(idFeContabilizacion), 'YYYYMMDD') AS fecha
  FROM STAGING_PE_CH.SQL_FABRIC.VENTA
  WHERE idFeContabilizacion = 20251015 --AND 20251231
)
SELECT
  TO_CHAR(DATE_TRUNC('MONTH', fecha), 'YYYYMM') AS periodo,
  COUNT(*) AS registros
FROM v
WHERE fecha IS NOT NULL
GROUP BY 1
ORDER BY 1;

select distinct idFeContabilizacion from STAGING_PE_CH.SQL_FABRIC.VENTA
order by idFeContabilizacion desc
;

select count (*) from STAGING_PE_CH.SQL_FABRIC.VENTA
where idFeContabilizacion = 20251020
;

SELECT *
FROM TABLE(UTILS.COALESCE.TEST_REGISTROS_ANALYSIS(
  '"PROD_BRONZE"."COMERCIAL"."STG_VENTA"', 
  'IDFECONTABILIZACION', 
  6 
))
;


ALTER TABLE STAGING_PE_CH.SQL_FABRIC.VENTA
ADD COLUMN ISC_POR FLOAT, 
           PRECIOTRANSFUNITXLT FLOAT, 
           IMPORTEISC_ML FLOAT
; 

SELECT 
    COLUMN_NAME,
    DATA_TYPE
FROM STAGING_PE_CH.INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_SCHEMA = 'SQL_FABRIC'
  AND TABLE_NAME = 'VENTA'
ORDER BY ORDINAL_POSITION;


SELECT 
    COLUMN_NAME,
    DATA_TYPE
FROM STAGING_PE_CH.INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_SCHEMA = 'SQL_FABRIC'
  AND TABLE_NAME = 'VENTA_RECHAZADA'
ORDER BY ORDINAL_POSITION;


SELECT 
    COLUMN_NAME,
    DATA_TYPE
FROM STAGING_PE_CH.INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_SCHEMA = 'SQL_FABRIC'
  AND TABLE_NAME = 'VENTA_PROGRAMADA'
ORDER BY ORDINAL_POSITION;






