SELECT * FROM STAGING_PE_CH.SQL_FABRIC.FILLRATE_D2
LIMIT 100; 

SELECT DISTINCT IDFECONTABILIZACION FROM STAGING_PE_CH.SQL_FABRIC.FILLRATE_D2
ORDER BY IDFECONTABILIZACION ASC;

SELECT 
    COLUMN_NAME,
    DATA_TYPE
FROM STAGING_PE_CH.INFORMATION_SCHEMA.COLUMNS
WHERE TABLE_SCHEMA = 'SQL_FABRIC'
  AND TABLE_NAME = 'VENTA_PROGRAMADA'
ORDER BY ORDINAL_POSITION;

ALTER TABLE STAGING_PE_CH.SQL_FABRIC.FILLRATE_D2
ADD COLUMN
    CAJAS_BONI_TOMAPEDIDO                         FLOAT,
    CAJAS_BONI_BLOQUEADO                          FLOAT,
    CAJAS_BONI_PROGRAMADAS                        FLOAT,
    CAJAS_BONI_NOPROGRAMADAS                      FLOAT,
    CAJAS_BONI_VENTA                              FLOAT,
    CAJAS_BONI_RECHAZADA                          FLOAT,
    CAJAS_BONI_NOPROGRAMADO_OTROS                 FLOAT,
    CAJAS_BONI_NOPROGRAMADO_NOPROGRAMADO          FLOAT,
    CAJAS_BONI_NOPROGRAMADO_FUERAHORA             FLOAT,
    CAJAS_BONI_NOPROGRAMADO_PEDIDOMINIMO          FLOAT,
    CAJAS_BONI_NOPROGRAMADO_PEDIDOANULADO         FLOAT,
    VOLUMEN_BONI_TOMAPEDIDO                       FLOAT,
    VOLUMEN_BONI_BLOQUEADO                        FLOAT,
    VOLUMEN_BONI_PROGRAMADAS                      FLOAT,
    VOLUMEN_BONI_NOPROGRAMADAS                    FLOAT,
    VOLUMEN_BONI_VENTA                            FLOAT,
    VOLUMEN_BONI_RECHAZADA                        FLOAT,
    VOLUMEN_BONI_NOPROGRAMADO_OTROS               FLOAT,
    VOLUMEN_BONI_NOPROGRAMADO_NOPROGRAMADO        FLOAT,
    VOLUMEN_BONI_NOPROGRAMADO_FUERAHORA           FLOAT,
    VOLUMEN_BONI_NOPROGRAMADO_PEDIDOMINIMO        FLOAT,
    VOLUMEN_BONI_NOPROGRAMADO_PEDIDOANULADO       FLOAT,
    UNIDAD_VENTA_TOMAPEDIDO                       FLOAT,
    UNIDAD_VENTA_BLOQUEADO                        FLOAT,
    UNIDAD_VENTA_PROGRAMADAS                      FLOAT,
    UNIDAD_VENTA_NOPROGRAMADAS                    FLOAT,
    UNIDAD_VENTA_LIQUIDADA                        FLOAT,
    UNIDAD_VENTA_RECHAZADA                        FLOAT,
    UNIDAD_BONI_TOMAPEDIDO                        FLOAT,
    UNIDAD_BONI_BLOQUEADO                         FLOAT,
    UNIDAD_BONI_PROGRAMADAS                       FLOAT,
    UNIDAD_BONI_NOPROGRAMADAS                     FLOAT,
    UNIDAD_BONI_LIQUIDADA                         FLOAT,
    UNIDAD_BONI_RECHAZADA                         FLOAT;


ALTER TABLE STAGING_PE_CH.SQL_FABRIC.VENTA_RECHAZADA
ADD COLUMN
    UNIDAD_VTA_RCHZD      FLOAT,
    UNIDAD_BONI_RCHZ      FLOAT,
    UNIDAD_VTA_DEVFISICA  FLOAT;

ALTER TABLE STAGING_PE_CH.SQL_FABRIC.VENTA_RECHAZADA
RENAME COLUMN UNIDAD_VTA_RCHZD TO UNIDAD_VTA_RCHZ
;
SELECT 
IDFECHAPEDIDO
 FROM STAGING_PE_CH.SQL_FABRIC.VENTA_PROGRAMADA LIMIT 100;

SELECT COUNT(*) FROM STAGING_PE_CH.SQL_FABRIC.FILLRATE_D2 ; 

SELECT distinct idFeReparto, idFeContabilizacion 
FROM STAGING_PE_CH.SQL_FABRIC.FILLRATE_D2
where idFeContabilizacion >= 20240101
order by idFeContabilizacion asc
; 

SELECT 
    LEFT(idFeReparto, 6) AS MES_REPARTO,   -- YYYYMM
	idDpt,
    SUM(Cajas_Venta) AS CAJAS_VENTA,
	SUM(Cajas_Tomapedido) AS CAJAS_TOMAPEDIDO,
	SUM(Cajas_Programadas) AS CAJAS_PROGRAMADO
FROM STAGING_PE_CH.SQL_FABRIC.FILLRATE_D2
where idFeReparto >= 20250101
group by LEFT(idFeReparto, 6), idDpt
ORDER by LEFT(idFeReparto, 6), idDpt asc

; 

SELECT
MANDT,
idDpt, 
idCliente,
idProducto,
idFeContabilizacion,
idFeReparto,
idCliente,
idTransportista,
idRuta, 
idVendedor,
Cajas_Tomapedido,
Cajas_Programadas,
Cajas_Venta
FROM STAGING_PE_CH.SQL_FABRIC.FILLRATE_D2 
WHERE idFeReparto = 20250102


; 

TRUNCATE TABLE STAGING_PE_CH.SQL_FABRIC.FILLRATE_D2;

select * from STAGING_PE_CH.SQL_FABRIC.FILLRATE_D2 limit 10; 
