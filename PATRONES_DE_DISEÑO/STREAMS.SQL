DROP TABLE IF EXISTS DEV_SILVER_M.COMERCIAL.VENTAS;

CREATE OR REPLACE TABLE DEV_SILVER_M.COMERCIAL.TEST_INCREMENTAL_LOAD_VENTAS (
    CLIENTE VARCHAR(10) NOT NULL,
    ID_PAIS VARCHAR(5) NOT NULL,
    ID_SKU VARCHAR(18) NOT NULL,
    NOM_SKU VARCHAR(100),
    CANTIDAD_VENDIDAD_UN NUMBER(38,0),
    LITROS_VENDIDOS NUMBER(38,2),
    FECHA_VENTA DATE
); 

INSERT INTO DEV_SILVER_M.COMERCIAL.TEST_INCREMENTAL_LOAD_VENTAS (CLIENTE, ID_PAIS, ID_SKU, NOM_SKU, CANTIDAD_VENDIDAD_UN, LITROS_VENDIDOS, FECHA_VENTA) VALUES
('C001', 'US', 'SKU123456789012345', 'Producto A', 100, 250.50, '2025-10-20'),
('C002', 'MX', 'SKU987654321098765', 'Producto B', 200, 500.00, '2025-10-21'),
('C003', 'CA', 'SKU112233445566778', 'Producto C', 150, 375.75, '2025-10-22');

SELECT * FROM DEV_SILVER_M.COMERCIAL.TEST_INCREMENTAL_LOAD_VENTAS;

INSERT INTO DEV_SILVER_M.COMERCIAL.TEST_INCREMENTAL_LOAD_VENTAS (CLIENTE, ID_PAIS, ID_SKU, NOM_SKU, CANTIDAD_VENDIDAD_UN, LITROS_VENDIDOS, FECHA_VENTA) VALUES
('C004', 'US', 'SKU223344556677899', 'Producto E', 120, 300.00, '2025-10-24');

DELETE FROM DEV_SILVER_M.COMERCIAL.TEST_INCREMENTAL_LOAD_VENTAS
WHERE CLIENTE = 'C004' AND ID_PAIS = 'US' AND ID_SKU = 'SKU223344556677899';

INSERT INTO DEV_SILVER_M.COMERCIAL.TEST_INCREMENTAL_LOAD_VENTAS (CLIENTE, ID_PAIS, ID_SKU, NOM_SKU, CANTIDAD_VENDIDAD_UN, LITROS_VENDIDOS, FECHA_VENTA) VALUES
('C005', 'PE', 'SKU223344556677900', 'Producto F', 120, 300.00, '2025-10-25');

INSERT INTO DEV_SILVER_M.COMERCIAL.TEST_INCREMENTAL_LOAD_VENTAS (CLIENTE, ID_PAIS, ID_SKU, NOM_SKU, CANTIDAD_VENDIDAD_UN, LITROS_VENDIDOS, FECHA_VENTA) VALUES
('C006', 'CH', 'SKU223344556677901', 'Producto F', 120, 300.00, '2025-10-25');
DELETE FROM DEV_SILVER_M.COMERCIAL.TEST_INCREMENTAL_LOAD_VENTAS
WHERE CLIENTE = 'C006' AND ID_PAIS = 'CH' AND ID_SKU = 'SKU223344556677901';

///////////////// VALIDANDO EL STREAM INICIAL - QUE SALE DEL SORUCE /////////////////////// 

SELECT * FROM DEV_BRONZE_M.COMERCIAL.SIM_TEST_INCREMENTAL_LOAD_VENTAS_STREAM; 



//////////////// Limpieza de los STREAMS /////////////////////// 

DROP STREAM DEV_BRONZE_M.COMERCIAL.DSM_TEST_INCREMENTAL_LOAD_VENTAS_STREAM;
DROP STREAM DEV_BRONZE_M.COMERCIAL.SIM_TEST_INCREMENTAL_LOAD_VENTAS_STREAM; 



SELECT * FROM DEV_BRONZE_M.COMERCIAL.SIM_TEST_INCREMENTAL_LOAD_VENTAS_M_STREAM;
SELECT * FROM DEV_BRONZE_M.COMERCIAL.SIM_TEST_INCREMENTAL_LOAD_VENTAS_M_STREAM; 


////////////////////////////////////////////////////////////////////////////////////////////////////
///////////////////////// NUEVO VENTAS STREAM - Reproceso //////////////////////////////////////////
////////////////////////////////////////////////////////////////////////////////////////////////////

select * from DEV_BRONZE_M.COMERCIAL.STM_LIKP_STREAM;
select * from DEV_BRONZE_M.COMERCIAL.STM_VBPA_VE_STREAM;


SELECT COUNT(*) FROM DEV_BRONZE_M.COMERCIAL.STM_VBRK; 
-- 36587682
SELECT * FROM DEV_BRONZE_M.COMERCIAL.STM_VBRK LIMIT 100; 
SELECT COUNT(*) FROM STAGING_RD_HT_GT.SAP.VBRK; 
-- 36 587 682
SELECT * FROM STAGING_RD_HT_GT.SAP.VBRK LIMIT 100;

SELECT * FROM DEV_BRONZE_M.COMERCIAL.STM_VBRP; 
SELECT COUNT(*) FROM STAGING_RD_HT_GT.SAP.VBRP;
-- 216248253

SELECT DISTINCT POSNR FROM STAGING_RD_HT_GT.SAP.VBPA_VE